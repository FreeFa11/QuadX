<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'>
  <title>Connection</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif;
      background-color: #131312; color: #e0e0e0; padding: 10px; min-height: 100vh; overflow-y: auto;
    }
    h1 {
      font-size: 2rem; font-weight: 700; text-transform: uppercase; color: #5aa6f3; letter-spacing: 4px;
      text-shadow: 2px 2px 5px rgba(0,0,0,.3); margin-bottom: 20px; transition: .3s;
    }
    h1:hover { color: #943ce7; text-shadow: 2px 2px 8px rgba(0,0,0,.5); }
    #refresh-button {
      position: absolute; top: 40px; right: 30px; padding: 1px; font-size: 10px; background-color: #3b3b5c;
      color: white; border: none; cursor: pointer; border-radius: 5px;
    }
    #refresh-button:hover { background-color: #6b6b9e; }
    .section {
      width: min(85%, 550px); margin-bottom: 15px; background-color: #2c2c3e; padding: 15px;
      border-radius: 8px; border: 2px solid #1e1e2f;
    }
    .section-title { color: #5aa6f3; font-size: 1.2rem; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid #3b3b5c; }
    .input-group { margin-bottom: 12px; }
    .input-group label { display: block; margin-bottom: 5px; color: #d1d1d1; font-size: .95rem; }
    .input-field {
      width: 95%; padding: 10px; background-color: #3b3b5c; border: 1px solid #5aa6f3;
      border-radius: 5px; color: #e0e0e0; font-size: .95rem;
    }
    .input-field:focus { outline: none; border-color: #943ce7; }
    .radio-group { display: flex; gap: 20px; margin-bottom: 15px; }
    .radio-option { display: flex; align-items: center; cursor: pointer; }
    .radio-option input[type="radio"] {
      appearance: none; width: 18px; height: 18px; border: 2px solid #5aa6f3;
      border-radius: 50%; margin-right: 8px; cursor: pointer;
    }
    .radio-option input[type="radio"]:checked { background-color: #5aa6f3; box-shadow: 0 0 0 2px #292929 inset; }
    .radio-option label { color: #e0e0e0; cursor: pointer; }
    .save-button {
      background: linear-gradient(135deg, #26a5fa, #fa03ee); color: white; border: none; padding: 12px 25px;
      border-radius: 5px; font-size: 1rem; cursor: pointer; margin-top: 15px; box-shadow: 0 2px 5px rgba(0,0,0,.3);
      transition: .2s;
    }
    .save-button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,.3); }
    .save-button:active { transform: translateY(0); }
    .burger { position: fixed; top: 20px; left: 20px; cursor: pointer; z-index: 9999; }
    .burger div { width: 24px; height: 2px; background-color: #e0e0e0; margin: 5px 0; transition: .3s; }
    .nav-menu {
      position: fixed; top: 0; left: -220px; width: 170px; height: 100%; background-color: #1e1e1e;
      box-shadow: 2px 0 5px rgba(0,0,0,.5); display: flex; flex-direction: column; padding-top: 60px; transition: .3s;
    }
    .nav-menu.show { left: 0; }
    .nav-menu a {
      color: #e0e0e0; padding: 12px 20px; text-decoration: none; display: flex; align-items: center;
      font-size: 16px; border-bottom: 1px solid #2c2c2c;
    }
    .nav-menu a:hover { background-color: #2a2a2a; }
    .nav-icon { width: 30px; height: 30px; margin-right: 12px; flex-shrink: 0; }
    @media (max-width: 480px) {
      .section { width: 90%; }
      .radio-group { flex-direction: column; gap: 10px; }
    }
  </style>
</head>
<body>
  <h1>Connection</h1>
  <button id='refresh-button' onclick='location.reload();'>&#x21bb;</button>
  <div class="section">
    <div class="section-title">WiFi Mode</div>
    <div class="radio-group">
      <div class="radio-option"><input type="radio" id="modeAp" name="wifiMode" value="ap" checked><label for="modeAp">Access Point</label></div>
      <div class="radio-option"><input type="radio" id="modeStation" name="wifiMode" value="station"><label for="modeStation">Station (Client)</label></div>
    </div>
  </div>
  <div class="section" id="apSettings">
    <div class="section-title">Access Point Settings</div>
    <div class="input-group"><label for="apSsid">AP SSID:</label><input type="text" id="apSsid" class="input-field" placeholder="Enter AP SSID"></div>
    <div class="input-group"><label for="apPassword">AP Password:</label><input type="password" id="apPassword" class="input-field" placeholder="Enter AP password"></div>
  </div>
  <div class="section" id="stationSettings" style="display: none;">
    <div class="section-title">Station Settings</div>
    <div class="input-group"><label for="stationSsid">Network SSID:</label><input type="text" id="stationSsid" class="input-field" placeholder="Enter network SSID"></div>
    <div class="input-group"><label for="stationPassword">Network Password:</label><input type="password" id="stationPassword" class="input-field" placeholder="Enter network password"></div>
  </div>
  <button id="saveButton" class="save-button">Save Settings</button>
  <div class="burger" onclick="toggleMenu()"><div></div><div></div><div></div></div>
  <nav class="nav-menu" id="menu">
    <a href="./Controller.html"><img src="./controller-icon.svg" alt="Controller" class="nav-icon">Controller</a>
    <a href="./Calibration.html"><img src="./calibration-icon.svg" alt="Calibration" class="nav-icon">Calibration</a>
    <a href="./Connection.html"><img src="./connection-icon.svg" alt="Connection" class="nav-icon">Connection</a>
  </nav>
  <script>
    let socket;
    function connectWebSocket() {
      socket = new WebSocket(`ws://${window.location.hostname}/CommunicationSocket`);
      socket.onopen = () => socket.send(JSON.stringify({ type: 'Connection' }));
      socket.onmessage = (e) => {
        try {
          const m = JSON.parse(e.data);
          if (m.type === 'wifiSettings') {
            const a = m.data.mode === 'ap';
            document.getElementById('modeAp').checked = a;
            document.getElementById('modeStation').checked = !a;
            document.getElementById('apSettings').style.display = a ? 'block' : 'none';
            document.getElementById('stationSettings').style.display = a ? 'none' : 'block';
            document.getElementById('apSsid').value = m.data.ssid || 'QuadX';
            document.getElementById('stationSsid').value = m.data.ssid || '';
            document.getElementById('apPassword').value = m.data.password || '';
            document.getElementById('stationPassword').value = m.data.password || '';
          }
        } catch (e) { console.error('Parse error:', e); }
      };
      socket.onclose = () => setTimeout(connectWebSocket, 1000);
    }
    function toggleMode() {
      const a = document.querySelector('input[name="wifiMode"]:checked').value === 'ap';
      document.getElementById('apSettings').style.display = a ? 'block' : 'none';
      document.getElementById('stationSettings').style.display = a ? 'none' : 'block';
    }
    async function saveSettings() {
      const a = document.querySelector('input[name="wifiMode"]:checked').value === 'ap';
      const s = a ? document.getElementById('apSsid').value : document.getElementById('stationSsid').value;
      const p = a ? document.getElementById('apPassword').value : document.getElementById('stationPassword').value;
      const b = document.getElementById('saveButton');
      if (!s) { alert('Please enter SSID'); return; }
      if (socket?.readyState === WebSocket.OPEN) {
        b.disabled = true;
        b.textContent = 'Saving...';
        socket.send(JSON.stringify({ mode: a ? 'ap' : 'station', ssid: s, pass: p }));
        b.textContent = 'Saved!';
        setTimeout(() => { b.textContent = 'Save Settings'; b.disabled = false; }, 2000);
      } else {
        b.textContent = 'Error!';
        setTimeout(() => { b.textContent = 'Save Settings'; b.disabled = false; }, 2000);
      }
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('saveButton').addEventListener('click', saveSettings);
      document.querySelectorAll('input[name="wifiMode"]').forEach(r => r.addEventListener('change', toggleMode));
      document.getElementById('apSsid').value = 'QuadX';
      connectWebSocket();
    });
    function toggleMenu() { document.getElementById('menu').classList.toggle('show'); }
  </script>
</body>
</html>